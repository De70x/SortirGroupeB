{% extends 'base.html.twig' %}

{% block title %}Liste des sorties{% endblock %}

{% block main %}

    {% set CREEE = constant('App\\Entity\\Etat::CREEE') %}
    {% set OUVERTE = constant('App\\Entity\\Etat::OUVERTE') %}
    {% set CLOTUREE = constant('App\\Entity\\Etat::CLOTUREE') %}
    {% set EN_COURS = constant('App\\Entity\\Etat::EN_COURS') %}
    {% set PASSEE = constant('App\\Entity\\Etat::PASSEE') %}
    {% set ANNULEE = constant('App\\Entity\\Etat::ANNULEE') %}

    {% block form %}
        <div id="rechercheAvancee">
            {{ form_start(rechercheForm,{ 'attr': {'class': 'card'} }) }}
            <!-- site -->
            <div class="form-group row">
                <label for="form_site" class="col-sm-2 col-form-label">Site</label>
                <div class="erreur_form">
                    {{ form_errors(rechercheForm.site) }}
                </div>
                <div class="col-sm-10">
                    {{ form_widget(rechercheForm.site, { 'attr': {'class': 'form-control'} }) }}
                </div>
            </div>
            <!-- nom contient -->
            <div class="form-group row">
                <label for="nomContient" class="col-sm-2 col-form-label">Le nom contient</label>
                <div class="erreur_form">
                    {{ form_errors(rechercheForm.nomContient) }}
                </div>
                <div class="col-sm-10">
                    {{ form_widget(rechercheForm.nomContient, { 'attr': {'class': 'form-control', 'placeholder':'recherche', 'type':'search'} }) }}
                </div>
            </div>
            <div class="form-group row">
                <div class="col-sm-12">
                    <div class="container datesLiees">
                        <!-- entre début -->
                        <label for="form_dateDebut" class="col-sm-2 col-form-label">Entre le</label>
                        <div class='col-md-4'>
                            <div class="erreur_form">
                                {{ form_errors(rechercheForm.dateDebut) }}
                            </div>
                            <div class="form-group">
                                <div class="input-group date" id="form_dateDebut" data-target-input="nearest">
                                    {{ form_widget(rechercheForm.dateDebut, { 'attr': {'class': 'form-control datetimepicker-input', 'data-target':'#form_dateDebut'} }) }}
                                    <div class="input-group-append" data-target="#form_dateDebut"
                                         data-toggle="datetimepicker">
                                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <label for="form_dateFin" class="col-sm-2 col-form-label">Et le</label>
                        <div class='col-md-4'>
                            <div class="erreur_form">
                                {{ form_errors(rechercheForm.dateFin) }}
                            </div>
                            <div class="form-group">
                                <div class="input-group date" id="form_dateFin" data-target-input="nearest">
                                    {{ form_widget(rechercheForm.dateFin, { 'attr': {'class': 'form-control datetimepicker-input', 'data-target':'#form_dateFin'} }) }}
                                    <div class="input-group-append" data-target="#form_dateFin"
                                         data-toggle="datetimepicker">
                                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- organisateur -->
            <div class="form-check row">
                <div class="erreur_form">
                    {{ form_errors(rechercheForm.organisateur) }}
                </div>
                {{ form_widget(rechercheForm.organisateur, { 'attr': {'class': 'form-check-input', 'type':'checkbox'} }) }}
                <label for="form_organisateur" class="form-check-label">Sorties dont je suis
                    l'organisateur/trice</label>
            </div>
            <!-- inscrit -->
            <div class="form-check row">
                <div class="erreur_form">
                    {{ form_errors(rechercheForm.inscrit) }}
                </div>
                {{ form_widget(rechercheForm.inscrit, { 'attr': {'class': 'form-check-input', 'type':'checkbox'} }) }}
                <label for="form_inscrit" class="form-check-label">Sorties auxquelles je suis inscrit/e</label>
            </div>
            <!-- pas inscrit -->
            <div class="form-check row">
                <div class="erreur_form">
                    {{ form_errors(rechercheForm.pasInscrit) }}
                </div>
                {{ form_widget(rechercheForm.pasInscrit, { 'attr': {'class': 'form-check-input', 'type':'checkbox'} }) }}
                <label for="form_pasInscrit" class="form-check-label">Sorties auxquelles je ne suis pas
                    inscrit/e</label>
            </div>
            <!-- passées -->
            <div class="form-check row">
                <div class="erreur_form">
                    {{ form_errors(rechercheForm.passees) }}
                </div>
                {{ form_widget(rechercheForm.passees, { 'attr': {'class': 'form-check-input', 'type':'checkbox'} }) }}
                <label for="form_passees" class="form-check-label">Sorties passées</label>
            </div>
            <br>
            <button type="submit" class="btn btn-block" style="background-color: #ff8906; color:#fffffe">
                Rechercher
            </button>
            {{ form_end(rechercheForm) }}
        </div>
    {% endblock %}


    <table class="table table-striped table-light" id="listeSorties">
        <thead>
        <tr>
            <th scope="col">Nom de la sortie</th>
            <th scope="col">Date de la sortie</th>
            <th scope="col">Clôture</th>
            <th scope="col">Inscrits / Places</th>
            <th scope="col">Etat</th>
            <th scope="col">Inscrit ?</th>
            <th scope="col">Organisateur</th>
            <th scope="col">Actions</th>
        </tr>
        </thead>
        <tbody>
        {% for sortie in sorties %}
            {% if app.user != null %}
                {% if sortie.etat.libelle != CREEE or sortie.organisateur.id == app.user.id %}
                    <tr>
                        <th scope="row"><a href="{{ path('detailsSortie' , {'id':sortie.id}) }}">{{ sortie.nom }}</a></th>
                        <td>{{ sortie.dateHeureDebut|date("d/m/Y H:i") }}</td>
                        <td>{{ sortie.dateLimiteInscription|date("d/m/Y") }}</td>
                        <td>{{ nbInscritsParSortie[sortie.id] }} / {{ sortie.nbInscriptionsMax }}</td>
                        <td>{{ sortie.etat.libelle }}</td>
                        <td>
                            {% if sortie in sortiesUtilisateur %}
                                X
                            {% endif %}
                        </td>
                        <td>{{ sortie.organisateur.nom }}</td>

                        <td class="boutonsAction">
                            {% if sortie.organisateur.id != app.user.id %}
                                <button class="btn-sm btn-dark" href="#">Détail</button>
                            {% endif %}
                            {% if sortie.etat.libelle == CREEE and sortie.organisateur.id == app.user.id %}
                                <a href="{{ path('publierSortie', {'id':sortie.id}) }}"><button class="btn-sm btn-dark">Publier</button></a>
                            {% endif %}
                            {% if sortie not in sortiesUtilisateur and sortie.etat.libelle == OUVERTE and sortie.organisateur.id != app.user.id %}
                                <a href="{{ path('inscriptionSortie', {'id':sortie.id}) }}}}"><button class="btn-sm btn-dark">S'inscrire</button></a>
                            {% endif %}
                            {% if sortie in sortiesUtilisateur and sortie.etat.libelle == OUVERTE %}
                                <a href="{{ path('desistementSortie', {'id':sortie.id}) }}}}"><button class="btn-sm btn-dark">Se désister</button></a>
                            {% endif %}

                        </td>
                    </tr>
                {% endif %}
            {% endif %}
        {% endfor %}
        </tbody>
    </table>

{% endblock %}
